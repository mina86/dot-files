#!/bin/sh

if [ $# -eq 0 ]; then
	if [ -n "$DISPLAY" ]; then
		emacsclient -a '' -c -n
	else
		emacsclient -a ''
	fi
	exit $?
fi

preopen=
case "$1" in --preopen-cmd=*)
	preopen="${1#*=}"
	shift
esac

if [ -n "$preopen" ]; then
	$preopen "$@"
fi

if emacsclient -n "$@" 2>/dev/null; then
	: ok
elif [ -n "$DISPLAY" ]; then
	emacsclient -a '' -n "$@"
else
	emacsclient -a '' "$@"
fi
