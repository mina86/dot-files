#!/bin/sh

have_sudo () {
	sudo=`which sudo 2>/dev/null`
	test x"$sudo" != x
}

escape() {
	if test=$(printf %q aoeu\ \'\"\ aoeu 2>/dev/null) &&
	   [ "x$test" = "xaoeu\\ \\'\\\"\\ aoeu" ]; then
		printf ' %q' "$@"
	else
		escaped=
		for arg; do
			escaped="$escaped '$(printf %s "$arg" |
			                     sed -e "s/'/'\\\\''/g")'"
		done
		printf %s "$escaped"
	fi
}

if [ $# -eq 0 ]; then
	if have_sudo; then
		"$sudo" -s
	else
		su
	fi
elif have_sudo; then
	"$sudo" "$@"
else
	su -c "$(escape "$@")"
fi
